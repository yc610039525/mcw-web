!function(a,b){"use strict";var c="position",d="absolute",e="px",f="left",g="top",h="innerHTML",i="className",j=null,k=function(){return document},l=function(a){return k().createElement(a)},m=function(){return l("div")},n=function(a,b,c){a.style.setProperty(b,c,j)},o=function(a,b,c){ht.Default.def(ht.widget[a],b,c)},p=function(a,b){a.appendChild(b)},q=function(a,b){a.removeChild(b)},r=function(){return k().body},s=function(){return k().documentElement},t=function(){return s().clientWidth},u=function(){return s().clientHeight},v=function(a,b,c,d){a.addEventListener(b,c,!!d)},w=function(a,b,c,d){a.removeEventListener(b,c,!!d)};ht.widget.ContextMenu=function(a){var b=this,c=b._view=m();c[i]="ht-widget-contextmenu",b.setItems(a),v(c,"contextmenu",function(a){a.preventDefault()}),v(c,"click",function(a){var d=a.target,e=c.children[0];if("separator"!==d[i]&&d!==c&&d!==e){for(var f=b._items,g=d.getAttribute("data-id");!g||"LI"!==d.tagName;)d=d.parentNode,g=d.getAttribute("data-id");if(!(d[i].indexOf("disabled")>=0)&&g&&f){var h=b._iterateItems(f,function(a){return a._id===g});h&&b._handleMenuItemSelected(h,a)}}}),b._bindingHandleDocKeyDown=b._handleDocKeyDown.bind(b),v(k(),"keydown",b._bindingHandleDocKeyDown)},o("ContextMenu",b,{_idCounter:0,_items:j,_subuls:j,_submenuMark:"â–¶",setSubmenuMark:function(a){this._submenuMark=a},setItems:function(a){var b=this;b._items=a,b.rebuild()},_handleMenuItemSelected:function(b,c){var d=this;if("check"===b.type)b.selected=!b.selected;else if("radio"===b.type){var e=b.groupId;d._iterateItems(d._items,function(a){a.groupId===e&&(a.selected=!1)}),b.selected=!0}if(d.hide(),b.action)b.action.apply(b.scope||a,[b,c]);else if(b.href){var f=b.linkTarget||"_self";a.open(b.href,f)}},getItemByProperty:function(a,b,c){var d=this;if(c=c||d._items,!c||0===c.length)return j;var e=d._iterateItems(c,function(c){return c[a]===b});return e||j},_iterateItems:function(a,b){for(var c=0;c<a.length;c++){var d=a[c];if(b(d))return d;if(d.items){var e=this._iterateItems(d.items,b);if(e)return e}}},_buildHtml:function(a,b){for(var c=this,d=0;d<a.length;d++){c._idCounter++;var e=a[d],f=l("li"),g=c._idCounter+"";if("separator"===e){var j=m();j[i]="separator",p(f,j)}else{e._id=g,f.setAttribute("data-id",g);var k=l("span"),n=l("span"),o=m(),q=m();if(o[i]="prefix","check"===e.type&&e.selected?o[i]+=" check-prefix":"radio"===e.type&&e.selected&&(o[i]+=" radio-prefix"),p(f,o),e.icon){var r=l("img");r.src=e.icon,p(k,r)}if(n[h]=e.label,p(k,n),p(f,k),q[i]="suffix",e.items&&(q[h]=c._submenuMark),e.suffix&&(q[h]=e.suffix),p(f,q),f[i]=0===d?"top-menu-item menu-item":d===a.length-1?"bottom-menu-item menu-item":"menu-item",e.disabled&&(f[i]+=" disabled"),e.items){c._subuls||(c._subuls=new ht.List);var s=l("ul");p(f,s),c._subuls.add(s),c._buildHtml(e.items,s)}}p(b,f)}},rebuild:function(){var a=this,b=a._items,c=a._view;if(c&&(c[h]="",a._subuls=j,a._idCounter=0,b&&0!==b.length)){var d=l("ul");a._buildHtml(b,d),p(c,d)}},addTo:function(a){if(a){var b=this;b._relatedView=a,b._bindingHandleDocMouseDown=b._handleDocMouseDown.bind(b),b._bindingHandleViewParentContextMenu=b._handleViewParentContextMenu.bind(b),v(k(),"mousedown",b._bindingHandleDocMouseDown),v(a,"contextmenu",b._bindingHandleViewParentContextMenu)}},show:function(b,h){var i=this,j=i._view;if(j){if(1===arguments.length){var k=b;b=k.pageX,h=k.pageY}var l=a.pageXOffset,m=a.pageYOffset,o={pageX:b,pageY:h,clientX:b-l,clientY:h-m,target:1,originEvent:k},q=o.clientX,s=o.clientY;i.beforeShow&&i.beforeShow(o);var v=i._items;if(v&&(k&&k.preventDefault(),v.length)){i.rebuild(),p(r(),j);var w=t(),x=u(),y=s+3-2,z=q+3-2,A=s+3+j.offsetHeight,B=q+3+j.offsetWidth,C=function(a){for(var b=0,c=0,d=0;d<a.children.length;d++){var f=a.children[d];if(f.getAttribute("data-id")){var g=f.children[1],h=f.children[2],i=g.offsetWidth,j=h.offsetWidth;i>b&&(b=i),j>c&&(c=j)}}for(d=0;d<a.children.length;d++){var f=a.children[d];if(f.getAttribute("data-id")){var g=f.children[1],h=f.children[2];n(g,"width",b+e),n(h,"width",c+e)}}};C(j.children[0]),A>x?n(j,g,y-(A-x)+m+e):n(j,g,y+m+e),B>w?n(j,f,z-(B-w)+l+e):n(j,f,z+l+e);var D=i._subuls;D&&D.each(function(b){C(b);for(var h=b.parentNode,i=0,j=0,k=h.offsetWidth,l=a.getComputedStyle(h);l[c]!==d;)i+=h.offsetTop,j+=h.offsetLeft,h=h.parentNode,l=a.getComputedStyle(h);n(b,g,i+e),n(b,f,j+k+e);var m=b.getBoundingClientRect(),o=m.top,p=m.left,q=m.height,r=m.width,s=o+q+2,t=p+r+2;s>x&&n(b,g,i+x-s+e),t>w&&n(b,f,j-r+e)}),i.afterShow&&i.afterShow(o)}}},isShowing:function(){return this._view?this._view.parentNode!=j:!1},hide:function(){var a=this,b=this._view;b&&(b.parentNode&&q(b.parentNode,b),a.afterHide&&a.afterHide())},_handleViewParentContextMenu:function(a){this.show(a)},_handleDocMouseDown:function(a){this._view.contains(a.target)||this.hide()},_handleDocKeyDown:function(a,b){var c=this;if(b=b||c._items,b&&b.length&&a.keyCode){var d=[a.keyCode];a.shiftKey&&d.push(16),a.ctrlKey&&d.push(17),a.altKey&&d.push(18),a.metaKey&&d.push(91),d.sort();var e=d.join(),f=c._iterateItems(b,function(a){if(a.key){var b=a.key.slice(0);return b.sort(),e===b.join()}});f&&(f.preventDefault!==!1&&a.preventDefault(),c._handleMenuItemSelected(f,a))}},dispose:function(){var a=this,b=a._relatedView,c=a._view;c&&(c.parentNode&&q(c.parentNode,c),w(k(),"mousedown",a._bindingHandleDocMouseDown),w(k(),"keydown",a._bindingHandleDocKeyDown),b&&w(b,"contextmenu",a._bindingHandleViewParentContextMenu),a._view=a._relatedView=a._bindingHandleDocMouseDown=a._bindingHandleDocKeyDown=a._bindingHandleViewParentContextMenu=j)}})}(this,Object);