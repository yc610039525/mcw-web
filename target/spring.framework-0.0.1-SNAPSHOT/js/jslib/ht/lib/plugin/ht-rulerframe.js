!function(a,b){"use strict";var c="position",d="absolute",e="relative",f="width",g="height",h="100%",i="px",j="left",k="right",l="top",m="bottom",n="display",o="none",p="block",q=ht.Default,r=Math.floor,s=Math.ceil,t=Math.PI,u=null,v=a.parseInt,w=function(a){return a.getContext("2d")},x=function(){return document},y=function(a){return x().createElement(a)},z=function(){return y("div")},A=function(){return y("canvas")},B=function(a,b,c){a.style.setProperty(b,c,u)},C=function(a,b,c){q.def(ht.widget[a],b,c)},D=function(a,b){a.appendChild(b)},E=function(a,b){a.removeChild(b)},F=function(a,b,c,d){a.addEventListener(b,c,!!d)},G=function(a,b,c,d){a.removeEventListener(b,c,!!d)};ht.widget.RulerFrame=function(a){var b=this,i=b._view=z(),j=b._topRuler=A(),k=b._rightRuler=A(),l=b._bottomRuler=A(),m=b._leftRuler=A();b._defaultRulerConfig={size:20,borderWidth:1,borderStyle:"solid",borderColor:"black",defaultMajorTickSpacing:50,minPhysicalMajorTickSpacing:50,maxPhysicalMajorTickSpacing:100,tickSpacingAdaptable:!0,majorTickTextFont:"12px Arial",majorTickTextColor:"black",majorTickColor:"black",minorTickColor:"#ccc",background:"rgba(0,0,0,0)",guideVisible:!1,guideColor:"#69BB9C",guideWidth:2},b._topRulerConfig={visible:!0},b._rightRulerConfig={visible:!1},b._bottomRulerConfig={visible:!1},b._leftRulerConfig={visible:!0},D(i,j),D(i,l),D(i,k),D(i,m),B(i,c,e),B(i,f,h),B(i,g,h),B(j,c,d),B(k,c,d),B(l,c,d),B(m,c,d),b._handleComponentPropertyChange=function(){b._selfInvalidate=1,b.iv()},b._handleMouseMove=function(a){(b._topRulerConfig.guideVisible||b._rightRulerConfig.guideVisible||b._bottomRulerConfig.guideVisible||b._leftRulerConfig.guideVisible||b._defaultRulerConfig.guideVisible)&&b._component&&(b._mousePosition={x:a.clientX,y:a.clientY},b._redraw())},b.setComponent(a)},C("RulerFrame",b,{ms_v:1,ms_fire:1,ms_ac:["defaultRulerConfig","topRulerConfig","rightRulerConfig","bottomRulerConfig","leftRulerConfig","component"],setComponent:function(a){var b=this,e=b._component,f=b.getView();if(f){if(b._component=a,b.fp("component",e,a),e){var g=b.getComponentView(e);E(f,g),G(f,"mousemove",b._handleMouseMove),b.removeComponentPropertyChangeListener(e,b._handleComponentPropertyChange)}if(a){var h=b.getComponentView(a);D(f,h),B(h,c,d),F(f,"mousemove",b._handleMouseMove),b.addComponentPropertyChangeListener(a,b._handleComponentPropertyChange)}}},addComponentPropertyChangeListener:function(a,b){a&&a.mp&&a.mp(b)},removeComponentPropertyChangeListener:function(a,b){a&&a.ump&&a.ump(b)},getComponentZoom:function(a){return a&&a.getZoom?a.getZoom():1},getComponentViewRect:function(a){return a&&a.getViewRect?a.getViewRect():void 0},getComponentView:function(a){return a&&a.getView?a.getView():a},invalidateComponent:function(a){a&&a.iv&&a.iv()},validateComponent:function(a){a&&a.validate&&a.validate()},_figureRulerStyle:function(a,b,c,d,e,f,g,h,i,j,k,l){if(b.visible){var m=this._defaultRulerConfig,r="borderStyle",s="borderColor",t="borderWidth",v="background",w=b[r]||m[r],x=b[s]||m[s],y=b[t]||m[t],z=b.size!=u?b.size:m.size,A=b[v]||m[v],C=z+y,D=this._allocateRulerStyle(y,w,x,a,c,e,C,g,h,i,j,k,l);B(a,e,"0px"),f?q.setCanvas(a,d-D,z):q.setCanvas(a,z,d-D),B(a,"background",A),B(a,n,p)}else B(a,n,o),B(this.getComponentView(this._component),e,"0px")},_allocateRulerStyle:function(a,b,c,d,e,f,g,h,j,k,l,m,n){var o=0;return B(d,e,a+"px "+b+" "+c),B(this.getComponentView(this._component),f,g+i),h?(B(d,j,k+i),o+=k):B(d,j,"0px"),l?(B(d,m,n+i),o+=n):B(d,m,"0px"),o},validateImpl:function(){var a=this,b=a._component,c=a._topRuler,d=a._rightRuler,e=a._bottomRuler,f=a._leftRuler,g=a._view,h=a._defaultRulerConfig,i=a._topRulerConfig,n=a._rightRulerConfig,o=a._bottomRulerConfig,p=a._leftRulerConfig,q=h.size;if(g&&b){var r=i.size!=u?i.size:q,s=n.size!=u?n.size:q,t=o.size!=u?o.size:q,v=p.size!=u?p.size:q;a._figureRulerStyle(c,i,"border-bottom",g.offsetWidth,l,!0,p.visible,j,v,n.visible,k,s),a._figureRulerStyle(d,n,"border-left",g.offsetHeight,k,!1,i.visible,l,r,o.visible,m,t),a._figureRulerStyle(e,o,"border-top",g.offsetWidth,m,!0,p.visible,j,v,n.visible,k,s),a._figureRulerStyle(f,p,"border-right",g.offsetHeight,j,!1,i.visible,l,r,o.visible,m,t),a._selfInvalidate?delete a._selfInvalidate:a.invalidateComponent(b),a.validateComponent(b),a._redraw()}},_redraw:function(){function a(a,c,d,e,f,g){if(c.visible){var h=w(a),i=c[x]||I,j=c[A]!=u?c[A]:L,k=c[B]||M,l=c[C]||N,m=c.size!=u?c.size:v,r=c[D]||O,s=c[E]||P,T=c[F]!=u?c[F]:Q,U=c[G]||R,V=c[H]||S;j&&(i=b[g]=b._calcMajortickSpacing(b[g]||i,c[y]||J,c[z]||K,n)),d.call(b,h,o,q,p,t,m,n,i,k,l,f,r,s);var W=b._mousePosition;T&&W&&(e?b._drawHGuide(h,W.x,m,U,V):b._drawVGuide(h,W.y,m,U,V))}}var b=this,c=b._topRuler,d=b._rightRuler,e=b._bottomRuler,f=b._leftRuler,g=b._topRulerConfig,h=b._rightRulerConfig,i=b._bottomRulerConfig,j=b._leftRulerConfig,k=b._defaultRulerConfig,l=b._component,m=b.getComponentViewRect(l),n=b.getComponentZoom(l),o=r(m.x*n),p=o+s(m.width*n),q=r(m.y*n),t=q+s(m.height*n),v=b._defaultRulerConfig.size,x="defaultMajorTickSpacing",y="maxPhysicalMajorTickSpacing",z="minPhysicalMajorTickSpacing",A="tickSpacingAdaptable",B="majorTickTextFont",C="majorTickTextColor",D="majorTickColor",E="minorTickColor",F="guideVisible",G="guideColor",H="guideWidth",I=k[x],J=k[y],K=k[z],L=k[A],M=k[B],N=k[C],O=k[D],P=k[E],Q=k[F],R=k[G],S=k[H];b._view&&l&&(a(c,g,b._drawH,!0,!1,"_currentTopMajorTickSpacing"),a(d,h,b._drawV,!1,!0,"_currentRightMajorTickSpacing"),a(e,i,b._drawH,!0,!0,"_currentBottomMajorTickSpacing"),a(f,j,b._drawV,!1,!1,"_currenLeftMajorTickSpacing"))},_calcMajortickSpacing:function(a,b,c,d){if(c>a*d)for(;b-10*d>=a*d;)a+=10;else if(a*d>b)for(;a*d>=c+10*d&&10!==a;)a-=10;return a},_drawHGuide:function(a,b,c,d,e){a.save(),q.translateAndScale(a,0,0,1),a.fillStyle=d,a.beginPath(),a.rect(b-(v(this.getComponentView(this._component).style.left)||0),0,e,c),a.fill(),a.restore()},_drawVGuide:function(a,b,c,d,e){a.save(),q.translateAndScale(a,0,0,1),a.fillStyle=d,a.beginPath(),a.rect(0,b-(v(this.getComponentView(this._component).style.top)||0),c,e),a.fill(),a.restore()},_drawH:function(a,b,c,d,e,f,g,h,i,j,k,l,m){a.save(),q.translateAndScale(a,-b,-c,1);var n=0,o=0,p=v(f/2),r=f-p,s=k?0:p,t=h*g,u=t/10;for(b-=t,a.clearRect(b,c,d-b,f),a.beginPath(),a.fillStyle=m,n=0;d>n;n+=u)a.rect(n,c+s,1,r);for(n=0;n>b;n-=u)a.rect(n,c+s,1,r);for(a.fill(),s=k?0:1,a.beginPath(),a.fillStyle=l,n=0,o=0;d>n;n+=t,o+=h)a.rect(n,c+s,1,f-1);for(n=0,o=0;n>b;n-=t,o-=h)a.rect(n,c+s,1,f-1);a.fill();var w=v(/\d+px/.exec(i)[0]),x=(w||10)/2;for(a.textBaseline="middle",s=k?f-x-2:x+2,a.beginPath(),a.fillStyle=j,a.font=i,n=0,o=0;d>n;n+=t,o+=h)a.fillText(o,n+2,c+s);for(n=0,o=0;n>b;n-=t,o-=h)a.fillText(o,n+2,c+s);a.restore()},_drawV:function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(b,c,d,e,f,g){a.translate(b+c,d),a.rotate(-e),a.translate(-b-c,-d),a.fillText(f,b+c+(g?2:1),d),a.translate(b+c,d),a.rotate(e),a.translate(-b-c,-d)}a.save(),q.translateAndScale(a,-b,-c,1);var o=0,p=0,r=v(f/2),s=f-r,u=k?0:r,w=h*g,x=w/10;for(c-=w,e+=w,a.clearRect(b,c,f,e-c),a.font=i,a.beginPath(),a.fillStyle=m,o=0;e>o;o+=x)a.rect(b+u,o,s,1);for(o=0;o>c;o-=x)a.rect(b+u,o,s,1);for(a.fill(),u=k?0:1,a.beginPath(),a.fillStyle=l,o=0,p=0;e>o;o+=w,p+=h)a.rect(b+u,o,f-1,1);for(o=0,p=0;o>c;o-=w,p-=h)a.rect(b+u,o,f-1,1);a.fill();var y=v(/\d+px/.exec(i)[0]),z=(y||10)/2,A=90*t/180;for(a.textBaseline="middle",u=k?f-z:z+2,A=k?-A:A,a.beginPath(),a.fillStyle=j,a.font=i,o=0,p=0;e>o;o+=w,p+=h)n(b,u,o,A,p,k);for(o=0,p=0;o>c;o-=w,p-=h)n(b,u,o,A,p,k);a.restore()},onPropertyChanged:function(){this.iv()},dispose:function(){var a=this,b=a._component,c=a._view;b&&a.removeComponentPropertyChangeListener(b,a._handleComponentPropertyChange),c&&(G(c,"mousemove",a._handleMouseMove),E(c.parentNode,c),a._view=null)}})}(this,Object);