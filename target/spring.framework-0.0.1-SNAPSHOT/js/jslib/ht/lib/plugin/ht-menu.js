!function(a,b){"use strict";var c="innerHTML",d="className",e=null,f=function(){return document},g=function(a){return f().createElement(a)},h=function(){return g("div")},i=function(a,b,c){ht.Default.def(ht.widget[a],b,c)},j=function(a,b){a.appendChild(b)},k=function(a,b){a.removeChild(b)},l=function(a,b,c,d){a.addEventListener(b,c,!!d)},m=function(a,b,c,d){a.removeEventListener(b,c,!!d)};ht.widget.Menu=function(a){var b=this,c=b._view=h(),e=b._dropdownMenu=new ht.widget.ContextMenu,i=g("ul");e._view[d]="ht-widget-dropdownmenu",c[d]="ht-widget-menu",i[d]="header",j(c,i),b.setItems(a),l(c,"mousedown",function(a){var c=a.target;if(0===a.button&&i!==c&&i.contains(c))if(e.isShowing())b.hideDropdownMenu();else{for(;"header-item"!==c[d];)c=c.parentNode;b.showDropdownMenu(c.getAttribute("data-index"))}}),l(c,"mouseover",function(a){var d=a.target;if(c.contains(d)){for(var f=c.querySelectorAll(".header-item"),g=!1,h=0;h<f.length;h++){var i=f[h];if(i.contains(d)){g=!0;break}}g&&e.isShowing()&&b.showDropdownMenu(i.getAttribute("data-index"))}}),e.afterHide=b._afterDropdownMenuHide.bind(b),e.afterShow=b._afterDropdownMenuShow.bind(b),m(f(),"keydown",e._bindingHandleDocKeyDown)},i("Menu",b,{_items:e,_dropdownMenuItems:{},setItems:function(a){var b=this,e=b._view;if(b._items=a,e.children[0][c]="",b._dropdownMenuItems={},a&&a.length){var h=e.children[0],i=0,k=f().createDocumentFragment();for(b._dropdownMenu._iterateItems(a,function(a){a.icon&&b._preLoadImage(a.icon)});i<a.length;i++){var l=a[i],m=g("li"),n=g("span");if(l.icon){var o=g("img");o.src=l.icon,j(m,o)}m[d]="header-item",m.setAttribute("data-index",i),b._dropdownMenuItems[i]=l.items,n[c]=l.label,j(m,n),j(k,m)}j(h,k)}},showDropdownMenu:function(b){var c=this,d=c._dropdownMenuItems[b],e=c._dropdownMenu,f=c._view.children[0].children[b],g=c._showingHeaderItem;if(f&&f!==g){g&&c._afterDropdownMenuHide();var h=f.getBoundingClientRect();c._showingHeaderItem=f,e.setItems(d),e.show(h.left+a.pageXOffset,h.top+h.height+a.pageYOffset)}},hideDropdownMenu:function(){this._dropdownMenu.hide()},getItemByProperty:function(a,b){var c=this,d=c._items;return d&&0!==d.length?c._dropdownMenu.getItemByProperty(a,b,d):e},_afterDropdownMenuShow:function(){var b=this,c=b._showingHeaderItem,d=a.getComputedStyle(c,":hover"),e=d.backgroundColor,f=d.color;c.style.backgroundColor=e,c.style.color=f},_afterDropdownMenuHide:function(){var a=this,b=a._showingHeaderItem;b&&(b.style.backgroundColor="",b.style.color="",a._showingHeaderItem=e)},_handleDocMouseDown:function(a){var b=this,c=b._view,d=b._dropdownMenu,e=c.children[0];e.contains(a.target)||d._view.contains(a.target)||b.hideDropdownMenu()},_handleDocKeyDown:function(a){var b=this,c=b._dropdownMenu;c._handleDocKeyDown.call(c,a,b._items)},_preLoadImage:function(a,b){var c=new Image;c.onload=function(){c.onload=null,b&&b(c)},c.src=a},getShowingMenuIndex:function(){var a=this._showingHeaderItem;return a?a.getAttribute("data-index"):-1},addTo:function(a){var b=this,c=b._view;j(a,c);var d=b._bindingHandleDocMouseDown=b._handleDocMouseDown.bind(b);l(f(),"mousedown",d);var e=b._bindingHandleDocKeyDown=b._handleDocKeyDown.bind(b);l(f(),"keydown",e)},dispose:function(){var a=this,b=a._view;b&&(b.parentNode&&k(b.parentNode,b),m(f(),"mousedown",a._bindingHandleDocMouseDown),m(f(),"keydown",a._bindingHandleDocKeyDown),a._view=a._bindingHandleDocMouseDown=a._bindingHandleDocKeyDown=e)}})}(this,Object);